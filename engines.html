<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Search the web together">
    <meta name="author" content="searsia.org">
    <link rel="icon" href="images/searsia.png">
    <title>Searsia - Engines</title>
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/searsia-doc.css" rel="stylesheet">
  </head>

  <body class="searsia-doc">

    <div class="container">

      <!-- Static navbar -->
      <nav class="navbar navbar-default">
        <div class="container-fluid">
          <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="index.html">Searsia</a>
          </div>
          <div id="navbar" class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
              <li><a href="about.html">About</a></li>
              <li><a href="start.html">Start</a></li>
              <li class="active"><a href="engines.html">Engines</a></li>
              <li><a href="protocol.html">Protocol</a></li>
              <li><a href="people.html">People</a></li>
            </ul>
          <div class="col-sm-3 pull-right">
            <form id="searsia-form" class="navbar-form" action="search.html" method="get">
            <div class="input-group input-group-sm">
            <input type="text" class="form-control" placeholder="search" name="q" id="query">
            <div class="input-group-btn">
                <button class="btn btn-default" type="submit"><span class="glyphicon glyphicon-search"></span></button>
            </div>
            </div>
            </form>
          </div>
          </div><!--/.nav-collapse -->
        </div><!--/.container-fluid -->
      </nav>

      <!-- Main component for a primary marketing message or call to action -->
      <div class="row">
        <div class="col-md-8"> 
        <h1>Engines <img src="images/searsia.png" alt=""></h1>
        <p>To see a list of all resources (search engines) that are used by your server, open <code>settings.html</code> in your client.
           This will show a table with resources, about 25 if you connect to the University of
           Twente Searsia server.
           In the list of resources, one of the search engines is the University of Twente Searsia server. We will call this
           resource the 'mother': It is the search engine that is fully trusted, like you would trust your mother. 
           A client (or another) server will copy all the 
           resources from its mother. This way, configurations can be quickly shared, and a copy of --for instance--
           the University of Twente Searsia server can be quickly instantiated.
           To enable updates, start the (mother) server with the <a href="start.html#serveroptions">--open</a> option. 
           (BEWARE: This will enable <em>anyone</em> to update your server. Searsia does not support authentication at the moment.)
           To add a resource, click on the "+Add" button on the bottom of the <code>settings.html</code> page.
        </p>

        <h2 id="adding-searsia">Adding a Searsia resource</h2>
        <p>
          To add a <b>Searsia</b> resource (an engine that implements the Searsia protocol, returning results of mime-type <code>application/searsia+json</code>), enter a unique Identifier (<em><a href="#field-id">Id</a></em>), and the resource' <em><a href="#field-api-template">API template</a></em>. The <em><a href="#field-id">Id</a></em> should be unique in your server. The <em><a href="#field-api-template">API template</a></em> is the url of the resource, where the query is replaced by <code>{q}</code> or <code>{q?}</code> (where the question mark should be used if the query is optional). After clicking "Update", the server tests the resource. A pop-up window appears with the results of the test, and a message explaining whether the resource is added or not.
        </p>

        <h2 id="adding-html">Adding an HTML resource</h2>
        <p>
         The server can get search results by <a href="https://en.wikipedia.org/wiki/Data_scraping">scraping</a> the HTML that search engines return for their end users. To add an HTML resource, use <code>text/html</code> in the field <em><a href="#field-mime-type">Mime type</a></em>. As the field <em><a href="#field-api-template">API Template</a></em>, take the resource' URL from your browser after querying the search engine, replacing the query in the url by <code>{q}</code>. If the URL does not contain a query, the search engine probably uses a <a href="https://en.wikipedia.org/wiki/POST_%28HTTP%29">POST request</a>. To find out what the POST request is, we recommend <a href="https://addons.mozilla.org/en-US/firefox/addon/live-http-headers/">Live HTTP Headers</a> for Firefox. Put the POST string, replacing the query by <code>{q}</code> in the field <em><a href="#field-post-string">Post string</a></em>.
        </p>
        <p id="scraping">
         Searsia uses <a href="https://en.wikipedia.org/wiki/XPath">XPath 1.0</a> to extract the search results from the web page. XPath is a query language for selecting elements of semi-structured data. Suppose the search results are displayed as list elements on the page, then these are encode as <code>&lt;li&gt;</code> ... <code>&lt;/li&gt;</code> on the page, and they can be extracted from the page with the XPath query <code>//li</code>. To find the most likely XPath query, we recommend <a href="http://dolf.trieschnigg.nl/srf/">Search Result Finder</a> for Firefox. Fill in the XPath query in the field <em><a href="#field-item-xpath">Item XPath</a></em>. To tell Searsia how to extract the components of the search result, add <em><a href="#field-xpaths">XPaths</a></em> for the fields <code>title</code>, <code>description</code>, <code>link</code>, or any other field you like (the client also supports <code>image</code>). 
        </p>

<h2 id="adding-xml">Adding an XML or JSON resource</h2>
<p>
To add an XML resource, fill in <code>application/xml</code> in the field 
<em><a href="#field-mime-type">Mime type</a></em>. Then proceed as 
<a href="#adding-html">above</a>. The Firefox Search Result Finder cannot 
be used in this case.
</p>
<p>To add a JSON resource, fill in <code>application/json</code> in the 
field <em><a href="#field-mime-type">Mime type</a></em>. Searsia also 
uses XPath queries to interpret JSON output, by internally converting JSON 
to XML, where each JSON attribute name is converted to an XML element; 
JSON lists are converted to repeated XML elements with the JSON list's 
name. 
</p>

<h2 id="examples">Examples</h2>
<p>
Searsia supports many API's by including API keys as secret 
<em><a href="#field-parameters">parameters</a></em> that will not be 
shared, as well the possibility to add custom HTTP 
<em><a href="#field-headers">headers</a></em>.
Look at the <a href="https://search.utwente.nl/settings.html">University of 
Twente settings</a> for examples of Searsia's resource configurations, 
including several examples that use HTML scrapers, and examples for 
accessing the API's of Google, Twitter, Facebook, Flickr, Instagram, and 
more. If you believe that Searsia is unable to get search results from
an existing resource that should be supported, please post your question
under <a href="https://github.com/searsia/searsiaserver/issues">Searsia
Server Issues</a>. Please, note that Searsia is not meant to scrape sites
that do not want to be scraped, and therefore does not contain ways to
circumvent for instance session cookies. 
</p>
<p>
While the Searsia resource configurations provide a way to get the search
results for a great variety of existing search engines, Searsia also 
provides a flexible way to structure the search results from these engines.
The search results, i.e., the objects in the <code>"hits"</code> list,
may contain any attribute that seems appropriate, for instance an
attribute <code>"phone_number"</code> for a telephone directory or
an attribute <code>"nr_of_citations"</code> for a search engine
that searches scientific papers. The following attributed are reserved:
</p>
<ul>
<li><code>"title"</code>: The title of the search results, that can be 
clicked to go to the web page that was found. Usually, the title is equals 
to the title of the web page that was found.  The title is the only 
attribute that is mandatory.</li>
<li><code>"url"</code>: The link to the web page that was found.</li>
<li><code>"description"</code>: A small summary describing the result. 
This might be a snippet from the web site containing the query, or some 
other summary.</li>
<li><code>"image"</code>: The url of a (thumbnail) image, to be 
displayed with the search result.</li>
</ul>

<p>
The <a href="resultsdemo.html">Results demo mockup</a> below shows 7 ways to present 
the search results from
<a href="https://en.wikipedia.org/w/api.php?action=opensearch&amp;format=xml&amp;search=informat&amp;namespace=0" rel="nofollow">Wikipedia's search suggestions</a>, 
that is the mockup shows the same search results 7 times using different
configurations.
</p>

<div class="panel panel-default" style="margin-top:2em">
  <div class="embed-responsive embed-responsive-resultsdemo">
    <iframe class="embed-responsive-item" src="resultsdemo.html"></iframe>
  </div>
</div>

<p>
The 7 results presentations are achieved as follows:
</p>
<ul>
<li>
<a href="searsia/wiki--wikididyoumean.json"><strong>wikididyoumean</strong></a>,
which' name is <em>"Did you mean:"</em>, 
returns a single search result, that contains the title as well as 
<code>"tags":"#suggestion"</code>, which tells the client to display the
result as a query suggestion.
</li>
<li>
<a href="searsia/wiki--wikifull.json"><strong>wikifull</strong></a>
(<em>Wikipedia Pages</em>)
returns title, description and URL. In this configuration, the domain of 
<code>"urltemplate"</code> (wikipedia.net) does not match the results' 
domains (wikipedia.org). Therefore, the client displays the URLs for each 
aggregated result. The <code>"urltemplate"</code> is the url that the 
user will use to search on the site, whereas the <code>"apitemplate"</code>
will be used by the server.
</li>
<li> 
<a href="searsia/wiki--wikiimage.json"><strong>wikiimage</strong></a>
(<em>Wikipedia Images</em>) returns title and image and 
<code>"tags":"#image"</code>, which tells the client to display the
results as an image result. Note how the XPath functions <code>concat()</code>
and <code>substring-after()</code> are used to create a custom image URL.
</li>
<li>
<a href="searsia/wiki--wikismall2.json"><strong>wikismall2</strong></a>,
which is called <em>Search Wikipedia for</em>, does not return URLs, which makes the client
infer the URL from the <code>"title"</code> and the <code>"urltemplate"</code>,
effectively creating a search engine that spawns a search on Wikipedia.
</li>
<li>
<a href="searsia/wiki--wikifull2.json"><strong>wikifull2</strong></a>
(<em>Wikipedia Again</em>) returns full search results with a thumbnail image, much
like the Wikipedia Pages engine above.
</li>
<li>
<a href="searsia/wiki--wikismall.json"><strong>wikismall</strong></a>
(<em>Wikipedia Small</em>) returns search results with <code>"tags":"#small"</code>,
telling the client to display the results on a single line.
</li>
<li>
<a href="searsia/wiki--wikirelated.json"><strong>wikirelated</strong></a> is called
<em>Related searches:</em>; It returns only the titles and <code>"tags":"#small"</code>.
The header <em>Related searches:</em> cannot be clicked because the resource does
not configure the <code>"urltemplate"</code> for the end user.
</li>
</ul>
<p>
Note that each configuration uses the same <code>"apitemplate"</code>: Each
of the 7 results effectively use the exact same search engine. 
Please <strong>do not</strong> use this example in a actual server configuration.
Note that the configuration of the mockup, if used in an actual Searsia Server, 
would send each query 7 times(!) to Wikipedia. 
</p>

        <h2 id="fields">An overview of all fields</h2>
        <p>
          The table below contains a quick reference for all fields:
        </p>
<table class="table table-bordered">
<tr><th>Parameter</th><th>Explanation</th></tr>
<tr id="field-id"><td>  *Id:</td>
  <td>A unique string identifying this resource. Should be unique within the server. </td></tr>

<tr><td>Name:</td>
  <td>A short name for this resource, to be displayed to the user. </td></tr>

<tr id="field-icon"><td>Icon:</td>
  <td>The url of the icon image, to be displayed to the user. Icons should have equal width and height.
Icons are preferably png files, not smaller than 48x48 pixels. </td></tr>

<tr id="field-user-template"><td style="white-space:nowrap">User template:</td>
  <td>A url specified following the <a href="#adding-searsia">searsia url template syntax</a>, to be used by users.  The mime type of this url must be <code>text/html</code> or <code>application/xml+xhtml</code>. </td></tr>

<tr id="field-api-template"><td style="white-space:nowrap">*API template:</td>
  <td>A url specified following the <a href="#adding-searsia">searsia url template syntax</a>, to be used by the server.</td></tr>

<tr id="field-post-string"><td>Post string:</td>
  <td>Only set if the API template HTTP method is POST, empty if the HTTP method is GET. Like the template, the post string may include parameters.</td></tr>

<tr id="field-mime-type"><td>Mime type:</td>
  <td>The format returned by the API Template. Supported formats are: <code>application/searsia+json</code>, <code>text/html</code>, <code>application/xml</code>, <code>application/json</code>. If omitted, the mime type <code>application/searsia+json</code> is assumed.</td></tr>

<tr id="field-test-query"><td> Test query:</td>
  <td>A query for which a search gives a non-empty result. If not set, the system should give a non-empty result for the query <code>searsia</code>.</td></tr>

<tr id="field-rerank"><td> Rerank:</td><td>Specifies a ranking algorithm or filter that is used to rerank/refilter the search results. Currently, only <code>or</code> is supported, filtering the returned results such that results that do not match any of the query terms are removed.</td></tr>

<tr><td> Prior:</td>
  <td>A value between 0 and 1 indicating the prior probability of a resource to be selected (prior to knowing the query). For instance, a value of 0.1 indicates that the resource gives relevant results for 1 in 10 queries. A value of 1 indicates that the resource <em>always</em> returns relevant results. In this case, the server likely returns the resource for every query. Values bigger than 1 are permitted to prioritize between multiple resources that are always selected. </td></tr>

<tr id="field-item-xpath"><td> Item XPath:</td>
  <td>An <a href="https://en.wikipedia.org/wiki/XPath">XPath 1.0</a> query that selects the search results from an HTML or XML result. XPath is also used to select results from JSON results, assuming a standard conversion to XML, where JSON lists are converted to repeated XML elements. </td></tr>

<tr id="field-xpaths"><td>XPaths:</td>
  <td>Field names and XPath queries for selecting parts of search results such as the title, url, and description. For example, the <code>title</code> would typically be selected as the first anchor text in a search result, i.e., <code>(.//a)[1]</code>. The XPath queries are evaluated with respect to an Item XPath context node, and they typically start with <code>.</code> (the 'self' axis step).
</td></tr>

<tr id="field-headers"><td> Headers:</td>
  <td>HTTP headers to be sent to the API Template, consisting of a field name (without ':') and the field value. Like API Template and Post String, the field value may include parameters. </td></tr>

<tr id="field-parameters"><td> Parameters:</td>
  <td>Secret parameter names and their values. Occurrences of the parameter names in the API Template, Post String or Headers will be replaced by the value. The server will not share the parameter names and values with other clients, so it is safe to use them for API keys and secrets. </td></tr>

</table>
<p>* mandatory settings</p>

        </div>
      </div>
      <footer>
        <hr>
        <p><strong>Next:</strong> The <a href="protocol.html">Searsia protocol</a>.</p>
      </footer>
    </div> <!-- /container -->

    <script src="js/jquery.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
  </body>
</html>


